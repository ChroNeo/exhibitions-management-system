FROM node:20-alpine

ENV NODE_ENV=development \
    PNPM_HOME=/usr/local/share/pnpm \
    PNPM_STORE_DIR=/app/.pnpm-store

WORKDIR /app

RUN corepack enable && corepack prepare pnpm@9 --activate \
 && pnpm config set store-dir ${PNPM_STORE_DIR} \
 && pnpm config set node-linker pnpm

# Copy workspace files
COPY pnpm-lock.yaml pnpm-workspace.yaml package.json ./
COPY apps/frontend/package.json ./apps/frontend/package.json

# Install dependencies
RUN pnpm --dir apps/frontend install --frozen-lockfile

# Copy frontend code
COPY apps/frontend ./apps/frontend

EXPOSE 5173
CMD ["pnpm", "--dir", "apps/frontend", "dev", "--", "--host", "0.0.0.0"]
